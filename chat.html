<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>智障问答系统</title>

    <style media="screen">
        .todo-table {
            margin: 0 auto;
        }
        .center {
            text-align: center;
        }
        .radio-button {
            display: inline-block;
            padding: 10px;
            cursor: pointer;
        }
        .gua-hide {
            display: none;
        }
    </style>

    <link rel="stylesheet" href="{{url_for('static', filename='pure-min.css')}}">

    <link href="{{url_for('static', filename='css/bootstrap.min.css')}}" rel="stylesheet">
    <link href="{{url_for('static', filename='font-awesome/css/font-awesome.css')}}" rel="stylesheet">

    <link href="{{url_for('static', filename='css/plugins/toastr/toastr.min.css')}}" rel="stylesheet">

    <link href="{{url_for('static', filename='js/plugins/gritter/jquery.gritter.css')}}" rel="stylesheet">

    <link href="{{url_for('static', filename='css/animate.css')}}" rel="stylesheet">
    <link href="{{url_for('static', filename='css/style.css')}}" rel="stylesheet">
</head>

<body>
    <div id="wrapper">
        <nav class="navbar-default navbar-static-side" role="navigation">
            <div class="sidebar-collapse">
                <ul class="nav metismenu" id="side-menu">
                    <li class="nav-header">
                        <div class="dropdown profile-element">
                            <span>
                                <img alt="image" class="img-circle" src="{{url_for('static', filename='img/profile_small.jpg')}}" />
                            </span>
                            <a data-toggle="dropdown" class="dropdown-toggle" href="index.html#">
                                <span class="clear">
                                    <span class="block m-t-xs"> <strong class="font-bold">Geovhbn</strong></span>
                                </span>
                            </a>
                        </div>
                    </li>
                    <li class="active">
                        <a><i class="fa fa-th-large"></i><span class="nav-label radio-button gua-tab" data-page='todo-list'>智障问答</span></a>
                    </li>
                    <li class="">
                        <a><i class="fa fa-diamond"></i><span class="nav-label radio-button gua-tab" data-page='todo-edit'>问题管理</span></a>
                    </li>
                    <li class="">
                        <a><i class="fa fa-bar-chart-o"></i><span class="nav-label radio-button gua-tab" data-page='todo-check'>系统设置参数</span></a>
                    </li>
                </ul>
            </div>
        </nav>
        <div id="page-wrapper" class="gray-bg dashbard-1">
            <div class="row border-bottom">
                <nav class="navbar navbar-static-top" role="navigation" style="margin-bottom: 0">
                    <ul class="nav navbar-top-links navbar-right">
                        <li>
                            <span class="m-r-sm text-muted welcome-message">系统管理系统</span>
                        </li>
                        <li>
                            <a href="login.html">
                                <i class="fa fa-sign-out"></i> 注销
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
            <div class="row gua-page todo-list border-bottom white-bg dashboard-header">
                <div class="col-sm-3" style="width:100%;">
                    <div class="row wrapper border-bottom white-bg page-heading">
                        <div class="col-lg-10">
                            <h2>智障问答室</h2>
                            <ol class="breadcrumb">
                                <li>
                                    <a href="index.html">Home</a>
                                </li>
                                <li>
                                    <a>Miscellaneous</a>
                                </li>
                                <li class="active">
                                    <strong>Chat view</strong>
                                </li>
                            </ol>
                        </div>
                        <div class="col-lg-2">

                        </div>
                    </div>
                    <div class="wrapper wrapper-content animated fadeInRight">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="ibox float-e-margins">
                                    <div class="ibox-content">

                                        <strong>Chat room </strong> can be used to create chat room in your app.
                                        You can also use a small chat in the right corner to provide live discussion.

                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-12">
                                    <div class="ibox chat-view">
                                        <div class="ibox-title">
                                            <small class="pull-right text-muted">Last message:  Mon Jan 26 2015 - 18:39:23</small>
                                             智障问答室
                                        </div>
                                        <div class="ibox-content">
                                            <div class="row">
                                                <div class="col-md-9" style="width:100%;">
                                                    <div class="chat-discussion">
                                                        <div class="chat-message left">
                                                            <img class="message-avatar" src="{{url_for('static', filename='img/a1.jpg')}}">
                                                            <div class="message">
                                                                <p class="message-author"> Michael Smith </p>
                    											<span class="message-date"> Mon Jan 26 2015 - 18:39:23 </span>
                                                                <span class="message-content">
                    											Lorem quam erat volutpat.
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <div class="chat-message right">
                                                            <img class="message-avatar" src="{{url_for('static', filename='img/a4.jpg')}}">
                                                            <div class="message">
                                                                <p class="message-author"> Karl Jordan </p>
                                                                <span class="message-date">  Fri Jan 25 2015 - 11:12:36 </span>
                                                                <span class="message-content">
                    											Many desktop publishing packages and web page  their defaull text, and a search for 'lorem ipsum' will uncover.
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <div class="chat-message-form">
                                                        <div class="form-group">
                                                            <textarea class="form-control message-input" name="message" placeholder="请输入要提问的问题"></textarea>
                                                        </div>
                                                        <button type="button" class="btn btn-block btn-outline btn-primary">发送</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                            </div>

                        </div>


                    </div>
                </div>
            </div>
            <div class="row gua-page todo-edit border-bottom white-bg dashboard-header">
                <div class="col-sm-3">
                    <div class="center">
                        <h1>问题集</h1>
                        <!-- 注意这里 的 url_for 也是需要加上蓝图名字前缀的 -->
                        <!-- action /todo/add-->
                        <form action='' method="post">
                            <input type="text" placeholder="Add question" name="question">
                            <input type="text" placeholder="Add answer" name="answer">
                            <input class="pure-button pure-button-primary" type="submit" value="Add">
                        </form>
                    </div>

                    <table class="todo-table pure-table pure-table-horizontal pure-table-striped">
                        <thead>
                            <tr>
                                <th>智障问题</th>
                                <th>更智障的回答</th>
                                <th>创建时间</th>
                                <th>删除</th>
                                <th>更改</th>
                            </tr>
                        </thead>
                        <tbody>
                        {% for t in todos %}
                            <tr>
                                <td>{{ t.question }}</td>
                                <td>{{ t.answer }}</td>
                                <td>{{ t.ct }}</td>
                                <!-- url_for 可以传递参数，先匹配动态路由，如果动态路由匹配失败则变成 query 参数 -->
                                <td><a href={{ url_for('.delete', todo_id=t.id) }}>delete</a></td>
                                <td><a href={{ url_for('.change', todo_id=t.id) }}>change</a></td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
    </div>

    <script src='{{url_for('static', filename='gua.js')}}'></script>
    <!-- Mainly scripts -->
    <script src="{{url_for('static', filename='js/jquery-2.1.1.js')}}"></script>
    <script src="{{url_for('static', filename='js/bootstrap.min.js')}}"></script>
    <script src="{{url_for('static', filename='js/plugins/metisMenu/jquery.metisMenu.js')}}"></script>
    <script src="{{url_for('static', filename='js/plugins/slimscroll/jquery.slimscroll.min.js')}}"></script>

    <!-- Flot -->
    <script src="{{url_for('static', filename='js/plugins/flot/jquery.flot.js')}}"></script>
    <script src="{{url_for('static', filename='js/plugins/flot/jquery.flot.tooltip.min.js')}}"></script>
    <script src="{{url_for('static', filename='js/plugins/flot/jquery.flot.spline.js')}}"></script>
    <script src="{{url_for('static', filename='js/plugins/flot/jquery.flot.resize.js')}}"></script>
    <script src="{{url_for('static', filename='js/plugins/flot/jquery.flot.pie.js')}}"></script>

    <!-- Peity -->
    <script src="{{url_for('static', filename='js/plugins/peity/jquery.peity.min.js')}}"></script>
    <script src="{{url_for('static', filename='js/demo/peity-demo.js')}}"></script>

    <!-- Custom and plugin javascript -->
    <script src="{{url_for('static', filename='js/inspinia.js')}}"></script>
    <script src="{{url_for('static', filename='js/plugins/pace/pace.min.js')}}"></script>

    <!-- jQuery UI -->
    <script src="{{url_for('static', filename='js/plugins/jquery-ui/jquery-ui.min.js')}}"></script>

    <!-- GITTER -->
    <script src="{{url_for('static', filename='js/plugins/gritter/jquery.gritter.min.js')}}"></script>

    <!-- Sparkline -->
    <script src="{{url_for('static', filename='js/plugins/sparkline/jquery.sparkline.min.js')}}"></script>

    <!-- Sparkline demo data  -->
    <script src="{{url_for('static', filename='js/demo/sparkline-demo.js')}}"></script>

    <!-- ChartJS-->
    <script src="{{url_for('static', filename='js/plugins/chartJs/Chart.min.js')}}"></script>

    <!-- Toastr -->
    <script src="{{url_for('static', filename='js/plugins/toastr/toastr.min.js')}}"></script>

    <script>
        var buttons = document.querySelectorAll('.radio-button')

        for (var i = 0; i < buttons.length; i++) {
            var button = buttons[i]
            button.addEventListener('click', function(event){
                var self = event.target
                clearActive()
                self.parentNode.parentNode.classList.add('active')
            })
        }

        var clearActive = function() {
            var active = document.querySelector('.active')
            if (active != null) {
                active.classList.remove("active")
            }
        }

        //SPA部分
        var bindEvents = function() {
            bindAll('.gua-tab', 'click', function(event) {
                var button = event.target
                var page = button.dataset.page
                log(page)
                showPage(page)
                pushState(page)
            })

            window.addEventListener('popstate', function(e) {
                //window函数参数中的e是什么鬼。。。
                var state = e.state
                var pageName = state.page
                //查的参数和class不一样
                showPage(pageName)
            })
        }

        //写一个可以删除一个指定class全部标签的函数
        //e被覆盖掉了,e有问题用find,用es改函数加上All，部分用e部分用es
        //for中可以用let
        var pushState = function(className) {
            var pageName = className.split('-')[1]
            var url = 'system_management.html?page=' + pageName
            var state = {
                page: className,
            }
            history.pushState(state, 'title', url)
            document.title = pageName
        }
        //push与show的矛盾

        var showPage = function(className) {
            var pages = es('.gua-page')
            for (var i = 0; i < pages.length; i++) {
                let page = pages[i]
                page.classList.add('gua-hide')
            }
            //上面的可以写成一个函数
            var selector = '.' + className
            var todonewDiv = e(selector)
            todonewDiv.classList.remove('gua-hide')
            if (className == 'todo-list') {
                //相当于刷新一遍
                // showtodoList()
            }
        }

        var initApp = function() {
            //在没有该函数的时候，默认的search是什么
            var query = location.search
            var [k, v] = query.slice(1).split('=')
            var page = 'list'
            var validPages = ['list', 'new']
            if (k == 'page') {
                if (validPages.includes(v)) {
                    page = v
                }
            }
            var pageName = 'todo-' + page
            showPage(pageName)
        }
        var __main = function() {
            bindEvents()
            // showtodoList()
            initApp()
        }

        __main()
    </script>
</body>
</html>
